<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Žij padel! – Instagram widget</title>

  <!-- Performance hints -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="preconnect" href="https://www.zijpadel.cz" crossorigin>
  <link rel="preload" as="image" href="https://www.zijpadel.cz/user/documents/upload/piktogramy/Instagram-Verification%20Badge-48.png">
  <link rel="preload" as="image" href="https://www.zijpadel.cz/user/documents/upload/piktogramy/ig-white-logo.png">

  <style>
    /* aby iframe neměl default margin */
    html,body{margin:0;padding:0;background:transparent}

    .zp-ig-widget{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue",Helvetica,Arial,sans-serif}
    .zp-ig-card{border-radius:22px;overflow:hidden;background:#fff;box-shadow:0 10px 30px rgba(0,0,0,.10);border:1px solid rgba(0,0,0,.06)}
    .zp-ig-header{display:flex;align-items:center;justify-content:center;gap:22px;flex-wrap:wrap;text-align:center;padding:16px 18px;background:linear-gradient(180deg,rgba(0,0,0,.03),rgba(0,0,0,0))}
    .zp-ig-brand{display:flex;align-items:center;gap:12px;text-decoration:none;color:inherit;min-width:0}
    .zp-ig-avatar{width:46px;height:46px;border-radius:999px;padding:2px;background:conic-gradient(from 180deg,#f58529,#dd2a7b,#8134af,#515bd4,#f58529);flex:0 0 auto}
    .zp-ig-avatar img{width:100%;height:100%;border-radius:999px;display:block;background:#fff;object-fit:cover}
    .zp-ig-title{display:flex;flex-direction:column;min-width:0}
    .zp-ig-name{display:inline-flex;align-items:center;gap:6px;font-weight:600;font-size:16px;line-height:1.1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .zp-ig-handle{font-size:13px;opacity:.7;margin-top:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

    .zp-ig-stats{display:flex;justify-content:space-between;gap:12px}
    .zp-ig-stat{flex:1;padding:10px 12px;text-align:center}
    .zp-ig-stat-num{font-weight:900;font-size:16px}
    .zp-ig-stat-lbl{font-size:12px;opacity:.7;margin-top:2px}

    .zp-ig-follow{text-decoration:none;background:#0095f6;color:#fff;font-weight:600;font-size:14px;padding:8px 14px;border-radius:8px;display:inline-flex;gap:6px;align-items:center;transition:transform .12s ease,opacity .12s ease,background .12s ease;flex:0 0 auto;will-change:transform}
    .zp-ig-follow:hover{background:#1877f2;transform:translateY(-1px)}
    .zp-ig-follow:active{transform:translateY(0);opacity:.95}
    .zp-ig-follow-icon{width:16px;height:16px;display:inline-block;background:url("https://www.zijpadel.cz/user/documents/upload/piktogramy/ig-white-logo.png") center/contain no-repeat;transform:translateY(1px)}

    .zp-ig-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:0;background:#eee}
    .zp-ig-item{position:relative;display:block;aspect-ratio:1/1;overflow:hidden;background:#f3f3f3}
    .zp-ig-item img{width:100%;height:100%;object-fit:cover;display:block;transform:scale(1.01);transition:transform .25s ease}
    .zp-ig-item:hover img{transform:scale(1.06)}

    .zp-ig-badge{position:absolute;top:10px;right:10px;background:rgba(0,0,0,.55);color:#fff;font-size:12px;padding:6px 8px;border-radius:10px;backdrop-filter:blur(6px);z-index:2}

    .zp-ig-verified{width:16px;height:16px;display:inline-block;flex:0 0 auto;background:url("https://www.zijpadel.cz/user/documents/upload/piktogramy/Instagram-Verification%20Badge-48.png") center/contain no-repeat;transform:translateY(1px)}

    .zp-ig-skeleton{aspect-ratio:1/1;background:linear-gradient(90deg,#f2f2f2,#e9e9e9,#f2f2f2);background-size:200% 100%;animation:zpIgShimmer 1.1s infinite linear}
    @keyframes zpIgShimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}

    .zp-ig-footer{padding:14px 18px;background:rgba(0,0,0,.02);border-top:1px solid rgba(0,0,0,.06);height:15px}

    /* Hover overlay */
    .zp-ig-item::after{content:"";position:absolute;inset:0;background:rgba(0,0,0,.55);opacity:0;transition:opacity .18s ease;pointer-events:none;z-index:1}
    .zp-ig-hover{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:14px;color:#fff;opacity:0;transform:translateY(6px);transition:opacity .18s ease,transform .18s ease;padding:18px;text-align:center;z-index:2;pointer-events:none;text-shadow:0 1px 2px rgba(0,0,0,.25)}
    .zp-ig-hover-top{display:flex;gap:28px;font-weight:800;font-size:18px;line-height:1}
    .zp-ig-hover-stat{display:inline-flex;align-items:center;gap:8px}
    .zp-ig-hover-ico{width:22px;height:22px;display:inline-block}
    .zp-ig-hover-caption{font-size:13px;line-height:1.35;max-width:90%;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;font-weight:600;opacity:.95}
    .zp-ig-item:hover::after{opacity:1}
    .zp-ig-item:hover .zp-ig-hover{opacity:1;transform:translateY(0)}
    @media (hover:none){.zp-ig-item::after,.zp-ig-hover{display:none!important}}
    @media (max-width:740px){.zp-ig-grid{grid-template-columns:repeat(2,1fr)}}
  </style>
</head>
<body>
  <section class="zp-ig-widget" aria-label="Instagram feed">
    <div class="zp-ig-card">
      <div class="zp-ig-header">
        <a class="zp-ig-brand" href="#" target="_blank" rel="noopener" id="zpIgProfileLink">
          <span class="zp-ig-avatar"><img id="zpIgAvatar" alt="Instagram profil" /></span>
          <span class="zp-ig-title">
            <span class="zp-ig-name" id="zpIgName">Instagram <span class="zp-ig-verified" aria-hidden="true"></span></span>
            <span class="zp-ig-handle" id="zpIgHandle">@...</span>
          </span>
        </a>

        <div class="zp-ig-stats" aria-label="Instagram statistiky">
          <div class="zp-ig-stat"><div class="zp-ig-stat-num" id="zpIgPosts">—</div><div class="zp-ig-stat-lbl">Příspěvky</div></div>
          <div class="zp-ig-stat"><div class="zp-ig-stat-num" id="zpIgFollowers">—</div><div class="zp-ig-stat-lbl">Sledující</div></div>
          <div class="zp-ig-stat"><div class="zp-ig-stat-num" id="zpIgFollowing">—</div><div class="zp-ig-stat-lbl">Sleduji</div></div>
        </div>

        <a class="zp-ig-follow" id="zpIgFollow" href="#" target="_blank" rel="noopener">
          <span class="zp-ig-follow-icon" aria-hidden="true"></span>
          <span>Sledovat</span>
        </a>
      </div>

      <div class="zp-ig-grid" id="zpIgGrid" aria-live="polite">
        <div class="zp-ig-skeleton"></div><div class="zp-ig-skeleton"></div><div class="zp-ig-skeleton"></div>
        <div class="zp-ig-skeleton"></div><div class="zp-ig-skeleton"></div><div class="zp-ig-skeleton"></div>
      </div>

      <div class="zp-ig-footer" aria-hidden="true"></div>
    </div>
  </section>

  <script>
  (function(){
    const DATA_URL="https://cdn.jsdelivr.net/gh/jiri-zijpadel/zijpadel-instagram-feed@main/data.json";
    const FOLLOW_URL="https://www.instagram.com/zijpadel_cz/";
    const FALLBACK_AVATAR="https://via.placeholder.com/96x96.png?text=ZP";
    const MAX_ITEMS=6;

    const $=id=>document.getElementById(id);
    const elGrid=$("zpIgGrid"), elName=$("zpIgName"), elHandle=$("zpIgHandle"), elAvatar=$("zpIgAvatar");
    const elFollow=$("zpIgFollow"), elProfileLink=$("zpIgProfileLink");
    const elPosts=$("zpIgPosts"), elFollowers=$("zpIgFollowers"), elFollowing=$("zpIgFollowing");

    elFollow.href=FOLLOW_URL;
    elProfileLink.href=FOLLOW_URL;

    function escapeHtml(s){
      return String(s||"")
        .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
        .replaceAll('"',"&quot;").replaceAll("'","&#039;");
    }
    function compactNumber(n){
      if(n===null||n===undefined) return "—";
      const num=Number(n);
      if(!Number.isFinite(num)) return "—";
      if(num>=1e6) return (num/1e6).toFixed(num>=10e6?0:1).replace(".",",")+" mil";
      if(num>=1e3) return (num/1e3).toFixed(num>=10e3?0:1).replace(".",",")+" tis";
      return String(num);
    }
    function bestThumb(item){ return item.thumbnail_url || item.media_url || ""; }
    function badge(item){
      if(item.media_type==="VIDEO") return "▶";
      if(item.media_type==="CAROUSEL_ALBUM") return "▦";
      return "";
    }

    const heartSvg='<svg class="zp-ig-hover-ico" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 21s-6.7-4.35-9.33-7.6C.6 10.88 1.2 7.9 3.5 6.3c2.02-1.42 4.6-.9 6.02.8L12 9.7l2.48-2.6c1.42-1.7 4-2.22 6.02-.8 2.3 1.6 2.9 4.58.83 7.1C18.7 16.65 12 21 12 21z"/></svg>';
    const bubbleSvg='<svg class="zp-ig-hover-ico" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M20 3H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h3.6l3.9 3.1c.7.55 1.5.05 1.5-.8V19H20a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/></svg>';

    async function load(){
      const res=await fetch(DATA_URL,{cache:"force-cache"});
      if(!res.ok) throw new Error("Failed to load data.json");
      const json=await res.json();

      const p=json.profile||{};
      const username=p.username||"";

      elName.innerHTML='Žij padel! <span class="zp-ig-verified" aria-hidden="true"></span>';
      elHandle.textContent=username ? ("@"+username) : "@zijpadel_cz";
      elAvatar.src=p.profile_picture_url || FALLBACK_AVATAR;

      elPosts.textContent=compactNumber(p.posts);
      elFollowers.textContent=compactNumber(p.followers);
      elFollowing.textContent=compactNumber(p.following);

      const items=(json.items||[]).slice(0,MAX_ITEMS);
      if(!items.length){
        elGrid.innerHTML='<div style="padding:18px; grid-column:1/-1;">Žádná data z Instagramu.</div>';
        return;
      }

      elGrid.innerHTML=items.map((it)=>{
        const href=it.permalink || FOLLOW_URL;
        const img=bestThumb(it);
        const caption=escapeHtml(it.caption).trim();

        const likes=(typeof it.like_count==="number") ? it.like_count : null;
        const comments=(typeof it.comments_count==="number") ? it.comments_count : null;

        const b=badge(it);
        return `
          <a class="zp-ig-item" href="${href}" target="_blank" rel="noopener">
            <img loading="lazy" decoding="async" src="${img}" alt="${caption ? caption.slice(0,80) : "Instagram post"}">
            ${b ? `<div class="zp-ig-badge">${b}</div>` : ``}
            <div class="zp-ig-hover" aria-hidden="true">
              <div class="zp-ig-hover-top">
                <span class="zp-ig-hover-stat">${heartSvg}<span>${compactNumber(likes)}</span></span>
                <span class="zp-ig-hover-stat">${bubbleSvg}<span>${compactNumber(comments)}</span></span>
              </div>
              ${caption ? `<div class="zp-ig-hover-caption">${caption}</div>` : ``}
            </div>
          </a>
        `;
      }).join("");
    }

    load().catch((err)=>{
      console.error(err);
      elGrid.innerHTML='<div style="padding:18px; grid-column:1/-1;">Nepodařilo se načíst Instagram feed.</div>';
    });

    // poslat rodiči výšku (pro auto-resize iframe)
    function postHeight(){
      const h=document.documentElement.scrollHeight || document.body.scrollHeight;
      parent && parent.postMessage({ type:"zpIgResize", height:h }, "*");
    }
    window.addEventListener("load", postHeight);
    new ResizeObserver(postHeight).observe(document.body);
  })();
  </script>
</body>
</html>
